//package com.github.axinger.controller;
//
//
//import com.google.code.kaptcha.impl.DefaultKaptcha;
//import org.springframework.beans.factory.annotation.Autowired;
//import org.springframework.stereotype.Controller;
//import org.springframework.web.bind.annotation.GetMapping;
//import org.springframework.web.bind.annotation.RequestMapping;
//import org.springframework.web.bind.annotation.RequestParam;
//
//import javax.imageio.ImageIO;
//import javax.servlet.ServletOutputStream;
//import javax.servlet.http.HttpServletRequest;
//import javax.servlet.http.HttpServletResponse;
//import javax.servlet.http.HttpSession;
//import java.awt.image.BufferedImage;
//import java.io.ByteArrayOutputStream;
//import java.util.Map;
//
//@Controller
//@RequestMapping("/kaptcha")
//public class KaptchaController {
//
//    @Autowired
//    private DefaultKaptcha captchaProducer;
//
//    @GetMapping("/code/create")
//    public void create(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) throws Exception {
//        byte[] captchaOutputStream = null;
//        ByteArrayOutputStream imgOutputStream = new ByteArrayOutputStream();
//        try {
//            //生产验证码字符串并保存到session中
//            String verifyCode = captchaProducer.createText();
//            httpServletRequest.getSession().setAttribute("verifyCode", verifyCode);
//            BufferedImage challenge = captchaProducer.createImage(verifyCode);
//            ImageIO.write(challenge, "jpg", imgOutputStream);
//        } catch (IllegalArgumentException e) {
//            httpServletResponse.sendError(HttpServletResponse.SC_NOT_FOUND);
//            return;
//        }
//        captchaOutputStream = imgOutputStream.toByteArray();
//        httpServletResponse.setHeader("Cache-Control", "no-store");
//        httpServletResponse.setHeader("Pragma", "no-cache");
//        httpServletResponse.setDateHeader("Expires", 0);
//        httpServletResponse.setContentType("image/jpeg");
//        ServletOutputStream responseOutputStream = httpServletResponse.getOutputStream();
//        responseOutputStream.write(captchaOutputStream);
//        responseOutputStream.flush();
//        responseOutputStream.close();
//    }
//
//    @GetMapping("/code/verify")
//    public Map<String, Object> verify(@RequestParam("verifyCode") String code,
//                                      HttpSession session) {
//        String captchaCode = String.valueOf(session.getAttribute("verifyCode"));
//        if (code.equals(captchaCode)) {
//            return Map.of("captchaCode", "成功" + captchaCode);
//        }
//        return Map.of("captchaCode", "过期" + captchaCode);
//    }
//}
